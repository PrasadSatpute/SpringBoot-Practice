<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Aadhaar Card List</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .aadhaar-card {
          width: 100%;
          max-width: 820px;
          border-radius: 8px;
          border: 1px solid #dbe4ea;
          box-shadow: 0 4px 20px rgba(27,40,60,0.08);
          overflow: hidden;
          font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
          background: linear-gradient(180deg, #ffffff 0%, #fbfdff 100%);
        }

        .aadhaar-top {
          background: linear-gradient(90deg, #0066b2 0%, #0080d1 100%);
          color: white;
          padding: 14px;
        }

        .brand {
          display: flex;
          align-items: center;
        }

        .emblem {
          width: 46px;
          height: 46px;
          border-radius: 6px;
          background: #ffffff22;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: 700;
          color: #fff;
          font-size: 16px;
          margin-right: 8px;
          border: 1px solid rgba(255,255,255,0.08);
        }

        .emblem-text { font-size: 10px; opacity: 0.9; }

        .title-line { font-weight: 700; font-size: 14px; letter-spacing: 0.2px; }
        .title-sub { font-size: 12px; opacity: 0.95; }

        .aadhaar-body { display: flex; background: #fff; }
        .left-col { width: 190px; border-right: 1px dashed #e6eef6; min-height: 220px; }
        .right-col { padding-left: 18px; }

        .photo-frame {
          width: 140px;
          height: 170px;
          border-radius: 6px;
          overflow: hidden;
          background: #f5f7fa;
          border: 1px solid #e6eef6;
          display:flex;
          align-items:center;
          justify-content:center;
        }

        .photo-frame img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display:block;
        }

        .qr-frame img {
          width: 80px;
          height: 80px;
          object-fit: contain;
          background: #fff;
          border: 1px solid #eee;
        }

        .details { padding-left: 10px; }

        .name {
          font-size: 20px;
          font-weight: 700;
          letter-spacing: 0.2px;
          color: #0b2540;
        }

        .monospace { font-family: "Roboto Mono", "Courier New", monospace; font-size: 14px; }
        .issue { font-size: 12px; opacity: 0.9; }

        .aadhaar-bottom { background: linear-gradient(180deg, #fbfdff, #f7fbff); border-top: 1px solid #eef6ff; }
        @media (max-width: 576px) {
          .left-col { width: 130px; }
          .photo-frame { width: 110px; height: 140px; }
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h2>Aadhaar Card List</h2>
    <a th:href="@{/aadhaar/create}" class="btn btn-primary mb-3">Add New Aadhaar Card</a>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th>Aadhaar Number</th>
            <th>Name</th>
            <th>Gender</th>
            <th>Mobile</th>
            <th>DOB</th>
            <th>Issue Date</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="card : ${aadhaarCards}">
            <td th:text="${card.aadhaarNumber}" th:id="'aadhaarNumber-' + ${card.aadhaarNumber}"></td>
            <td th:text="${card.fullName}" th:id="'fullName-' + ${card.aadhaarNumber}"></td>
            <td th:text="${card.gender}" th:id="'gender-' + ${card.aadhaarNumber}"></td>
            <td th:text="${card.mobileNumber}" th:id="'mobileNumber-' + ${card.aadhaarNumber}"></td>
            <td th:text="${card.dateOfBirth}" th:id="'dob-' + ${card.aadhaarNumber}"></td>
            <td th:text="${card.issueDate}" th:id="'issueDate-' + ${card.aadhaarNumber}"></td>
            <td>
                <a th:href="@{/aadhaar/edit/{id}(id=${card.aadhaarNumber})}" class="btn btn-sm btn-warning">Edit</a>
                <a th:href="@{/aadhaar/delete/{id}(id=${card.aadhaarNumber})}" class="btn btn-sm btn-danger"
                   onclick="return confirm('Are you sure you want to delete this Aadhaar card?')">Delete</a>
                <button
                        class="btn btn-info btn-sm"
                        data-bs-toggle="modal"
                        data-bs-target="#previewModal"
                        th:attr="data-doc-id=${card.aadhaarNumber}"
                        onclick="previewAadhaar(this)">Preview</button>
            </td>
        </tr>

        </tbody>
    </table>
</div>

<!-- Modal -->
<!--<div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">-->
<!--    <div class="modal-dialog modal-lg">-->
<!--        <div class="modal-content">-->
<!--            <div class="modal-header">-->
<!--                <h5 class="modal-title" id="previewModalLabel">Aadhaar Card Preview</h5>-->
<!--                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>-->
<!--            </div>-->
<!--            <div class="modal-body" id="previewContent">-->
<!--                &lt;!&ndash; Dynamic content will be injected here &ndash;&gt;-->
<!--            </div>-->
<!--            <div class="modal-footer">-->
<!--                <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<!-- Aadhaar Preview Modal (Sample / Stylized) -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0">
            <div class="modal-header">
                <h5 class="modal-title" id="previewModalLabel">Aadhaar Preview (Sample)</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body p-4">
                <!-- Card container -->
                <div class="aadhaar-card mx-auto">
                    <div class="aadhaar-top d-flex align-items-center">
                        <div class="brand">
                            <!-- Stylized emblem (NOT official) -->
                            <div class="emblem">ID</div>
                            <div class="emblem-text">GOVT. SAMPLE</div>
                        </div>
                        <div class="title ms-3">
                            <div class="title-line">Unique Identification Authority</div>
                            <div class="title-sub">Aadhaar (Sample Preview)</div>
                        </div>
                        <div class="ms-auto text-end small text-muted issue">Issue: <span id="previewIssueDate">--</span></div>
                    </div>

                    <div class="aadhaar-body d-flex">
                        <!-- left column: photo + qr -->
                        <div class="left-col d-flex flex-column align-items-center p-3">
                            <div class="photo-frame mb-2">
                                <img id="previewPhoto" src="" alt="Photo" onerror="this.src='data:image/svg+xml;charset=UTF-8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22140%22 height=%22170%22><rect width=%22100%25%22 height=%22100%25%22 fill=%22%23e9ecef%22/><text x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23777%22 font-size=%2214%22 font-family=%22Arial%22>Photo</text></svg>'" />
                            </div>

                            <div class="qr-frame mt-2">
                                <img id="previewQr" src="" alt="QR" onerror="this.src='data:image/svg+xml;charset=UTF-8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2280%22 height=%2280%22><rect width=%2280%22 height=%2280%22 fill=%22%23f1f1f1%22/><text x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23999%22 font-size=%2210%22>QR</text></svg>'" />
                            </div>
                        </div>

                        <!-- right column: details -->
                        <div class="right-col flex-grow-1 p-3">
                            <div class="details">
                                <div class="row mb-2">
                                    <div class="col-12 d-flex align-items-center">
                                        <div class="name ms-0" id="previewFullName">FULL NAME</div>
                                    </div>
                                </div>

                                <div class="row small text-muted mb-2">
                                    <div class="col-6">Aadhaar No.</div>
                                    <div class="col-6 text-end monospace" id="previewAadhaarNumber">xxxx xxxx xxxx</div>
                                </div>

                                <div class="row small mb-2">
                                    <div class="col-4 text-muted">DOB</div>
                                    <div class="col-8" id="previewDob">--</div>
                                </div>

                                <div class="row small mb-2">
                                    <div class="col-4 text-muted">Gender</div>
                                    <div class="col-8" id="previewGender">--</div>
                                </div>

                                <div class="row small mb-2">
                                    <div class="col-4 text-muted">Mobile</div>
                                    <div class="col-8" id="previewMobile">--</div>
                                </div>

                                <hr class="my-2">

                                <div class="row">
                                    <div class="col-12 text-muted small">Address</div>
                                    <div class="col-12" id="previewAddress">--</div>
                                </div>

                                <div class="row mt-3">
                                    <div class="col-8 text-muted small">Verification</div>
                                    <div class="col-4 text-end small" id="previewSuffix">Sample</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="aadhaar-bottom text-end small text-muted p-2">
                        <span>Sample Aadhaar Preview â€” Not valid for official use</span>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <!-- optional: download or print -->
                <button id="printPreviewBtn" class="btn btn-primary">Print</button>
            </div>
        </div>
    </div>
</div>

<!-- Small JS helper: call populatePreview(aadhaarObj) to fill fields and show modal -->
<script>
    /**
     * aadhaarObj example:
     * {
     *   aadhaarNumber: "123412341234",
     *   fullName: "John Doe",
     *   dateOfBirth: "1990-01-05",
     *   gender: "Male",
     *   address: "123 Street, City, State - 123456",
     *   mobileNumber: "9876543210",
     *   issueDate: "2020-05-01",
     *   photoUrl: "/path/to/photo.jpg",     // optional
     *   qrUrl: "/path/to/qr.png"           // optional
     * }
     */
    function formatAadhaarDisplay(number) {
      if (!number) return 'xxxx xxxx xxxx';
      // return grouped as 4-4-4
      return number.replace(/\s+/g, '').replace(/(\d{4})(\d{4})(\d{4})/, '$1 $2 $3');
    }

    function populatePreview(aadhaar) {
      // safe checks and fallback text
      document.getElementById('previewFullName').textContent = aadhaar.fullName || 'FULL NAME';
      document.getElementById('previewAadhaarNumber').textContent = formatAadhaarDisplay(aadhaar.aadhaarNumber);
      document.getElementById('previewDob').textContent = aadhaar.dateOfBirth || '--';
      document.getElementById('previewGender').textContent = aadhaar.gender || '--';
      document.getElementById('previewMobile').textContent = aadhaar.mobileNumber || '--';
      document.getElementById('previewAddress').textContent = aadhaar.address || '--';
      document.getElementById('previewIssueDate').textContent = aadhaar.issueDate || '--';
      document.getElementById('previewSuffix').textContent = 'Sample';

      // images (if provided)
      const photo = document.getElementById('previewPhoto');
      if (aadhaar.photoUrl) {
        photo.src = aadhaar.photoUrl;
      } else {
        photo.removeAttribute('src');
        photo.src = ''; // will trigger onerror placeholder
      }

      const qr = document.getElementById('previewQr');
      if (aadhaar.qrUrl) {
        qr.src = aadhaar.qrUrl;
      } else {
        qr.removeAttribute('src');
        qr.src = ''; // will trigger onerror placeholder
      }

      // open modal (Bootstrap 5)
      const modalEl = document.getElementById('previewModal');
      const modal = new bootstrap.Modal(modalEl);
      modal.show();
    }

    // Print button behavior: print only the modal content cleanly
    document.getElementById('printPreviewBtn').addEventListener('click', function () {
      const printContents = document.querySelector('#previewModal .aadhaar-card').outerHTML;
      const w = window.open('', '', 'width=900,height=700');
      w.document.write('<html><head><title>Print Aadhaar Preview</title>');
      w.document.write('<meta name="viewport" content="width=device-width, initial-scale=1">');
      // include Bootstrap CSS from the current document (optional, assumes it's available)
      const links = Array.from(document.querySelectorAll('link[rel="stylesheet"], style')).map(n => n.outerHTML).join('');
      w.document.write(links);
      w.document.write('</head><body style="padding:20px;display:flex;justify-content:center;">');
      w.document.write(printContents);
      w.document.write('</body></html>');
      w.document.close();
      w.focus();
      setTimeout(() => { w.print(); }, 300);
    });
</script>



<!--<script>-->
<!--    function previewAadhaar(button) {-->
<!--        const aadhaarNumber = button.getAttribute("data-doc-id");-->

<!--        const fullName = document.getElementById("fullName-" + aadhaarNumber)?.innerText || "N/A";-->
<!--        const gender = document.getElementById("gender-" + aadhaarNumber)?.innerText || "N/A";-->
<!--        const mobile = document.getElementById("mobileNumber-" + aadhaarNumber)?.innerText || "N/A";-->
<!--        const dob = document.getElementById("dob-" + aadhaarNumber)?.innerText || "N/A";-->
<!--        const issueDate = document.getElementById("issueDate-" + aadhaarNumber)?.innerText || "N/A";-->

<!--        const content = `-->
<!--            <div class="text-start">-->
<!--                <p><strong>Aadhaar Number:</strong> ${aadhaarNumber}</p>-->
<!--                <p><strong>Full Name:</strong> ${fullName}</p>-->
<!--                <p><strong>Gender:</strong> ${gender}</p>-->
<!--                <p><strong>Mobile Number:</strong> ${mobile}</p>-->
<!--                <p><strong>Date of Birth:</strong> ${dob}</p>-->
<!--                <p><strong>Issue Date:</strong> ${issueDate}</p>-->
<!--            </div>-->
<!--        `;-->

<!--        document.getElementById("previewContent").innerHTML = content;-->
<!--    }-->
<!--</script>-->


</body>
</html>
